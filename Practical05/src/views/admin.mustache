<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  {{>partials/nav}}

  <main class="container py-4">
    <h1 class="h4">Admin / Manager controls</h1>

    {{#msg}}
    <div class="alert alert-warning">{{msg}}</div>
    {{/msg}}

    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h2 class="h6">Index experiment (Admin only)</h2>
        <form method="post" action="/admin/index/create-order-date?role={{role}}" class="d-inline">
          <button class="btn btn-success" type="submit">Create idx_orders_order_date</button>
        </form>
        <form method="post" action="/admin/index/drop-order-date?role={{role}}" class="d-inline">
          <button class="btn btn-danger" type="submit">Drop idx_orders_order_date</button>
        </form>
      </div>
    </div>

    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h2 class="h6">Simulated Materialized View (Admin + Manager)</h2>
        <form method="post" action="/admin/mv/create?role={{role}}" class="d-inline">
          <button class="btn btn-outline-primary" type="submit">Create MV table</button>
        </form>
        <form method="post" action="/admin/mv/refresh?role={{role}}" class="d-inline">
          <button class="btn btn-primary" type="submit">Refresh MV data</button>
        </form>
      </div>
    </div>

    <h2 class="h6">Current indexes on orders</h2>

    {{^indexes}}
      <div class="alert alert-warning">No index rows returned (check DB connection / table exists).</div>
    {{/indexes}}

    <table class="table table-sm table-bordered bg-white">
      <thead><tr><th>Key_name</th><th>Column_name</th><th>Index_type</th></tr></thead>
      <tbody>
      {{#indexes}}
        <tr>
          <td>{{Key_name}}</td>
          <td>{{Column_name}}</td>
          <td>{{Index_type}}</td>
        </tr>
      {{/indexes}}
      </tbody>
    </table>

    <a class="btn btn-outline-secondary" href="/?role={{role}}">Back</a>
  </main>
</body>
</html>

